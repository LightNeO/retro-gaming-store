{% extends 'base.html' %}
{% block content %}
<div class="row mb-4">
    <div class="col-12 text-center">
        <h2 class="mb-3" style="color:#8be9fd;">Featured Consoles</h2>
        <div id="featured-consoles" class="row justify-content-center">
            <!-- Featured consoles will be loaded here by JS/API -->
            <div class="col-12">
                <p>Loading products...</p>
            </div>
        </div>
    </div>
</div>
<div class="row">
    <div class="col-12 text-center">
        <a href="/products/" class="btn btn-lg btn-primary" style="background:#ff79c6;border:none;font-family:'Press Start 2P',monospace;">Browse All Products</a>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script>
console.log('Index template loaded');
console.log('Featured consoles container:', document.getElementById('featured-consoles'));

console.log('Index.js code embedded directly');
document.addEventListener('DOMContentLoaded', function() {
    console.log('DOM loaded, loading featured products...');
    fetch('/api/products/?ordering=-rating&page_size=3')
        .then(response => {
            console.log('Response status:', response.status);
            if (!response.ok) {
                throw new Error(`HTTP error! status: ${response.status}`);
            }
            return response.json();
        })
        .then(data => {
            console.log('Products data:', data);
            const featured = document.getElementById('featured-consoles');
            if (!featured) {
                console.error('Featured consoles container not found');
                return;
            }
            const products = Array.isArray(data) ? data : (data.results || []);
            console.log('Number of products:', products.length);
            
            // Clear the loading message first
            featured.innerHTML = '';
            
            products.slice(0, 3).forEach(product => {
                const col = document.createElement('div');
                col.className = 'col-md-4 mb-4';
                col.innerHTML = `
                    <div class="card card-retro h-100">
                        <img src="${product.image}" class="card-img-top" alt="${product.name}" style="height:200px;object-fit:contain;background:#222;">
                        <div class="card-body">
                            <h5 class="card-title">${product.name}</h5>
                            <p class="card-text">${product.brand} (${product.release_year})</p>
                            <p class="card-text">$${product.price}</p>
                            <p class="card-text">‚≠ê ${product.rating}</p>
                            <a href="/product/?id=${product.id}" class="btn btn-pixel">View</a>
                        </div>
                    </div>
                `;
                featured.appendChild(col);
            });
        })
        .catch(error => {
            console.error('Error fetching products:', error);
            const featured = document.getElementById('featured-consoles');
            if (featured) {
                featured.innerHTML = '<div class="col-12 text-center"><p class="text-danger">Error loading products. Please check the console for details.</p></div>';
            }
        });
});
</script>
{% endblock %} 